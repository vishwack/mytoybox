# LUDown
.lu files help describe language understanding components for your bot. LUDown is a command line tool that helps convert .lu file(s) into JSON and TSV files that you can then use to create your [LUIS](http://luis.ai) app or [QnAMaker](http://qnamaker.ai) Knowledge base. 

The .lu file and the LUDown tool was born to serve few use cases:
- Quick, simple and easy way to bootstrap language understanding for your bot
- Describe intents, entities, utterances and patterns for your bot in simple markdown documents
- The langauge understanding definition for your bot lives with the rest of your code. You can use other CLI tools like luis to create a new LUIS app using the .lu files
- Group language understanding documents by langauge x locale for easier to manage localization purposes.
- Define question and answer pairs for your bot.
- Works in conjunction with other Microsoft Bot Builder tools like [luis CLI](https://github.com/Microsoft/botbuilder-tools/tree/master/LUIS), [QnAMaker CLI](https://github.com/Microsoft/botbuilder-tools/tree/master/QnAMaker)

## Installation
```bash
npm i -g ludown
```
## Arguments

| Argument												| Description 														|
|-------------------------------------------------------|-------------------------------------------------------------------|
|-o, --out_folder \<outputFolder\>						| Output folder for all files the tool will generate |
|-q, --quiet                                        	| Quiet, no trace messages |
|-h, --help                                         	| output usage information |
|-g, --gen_luis_only									| Write generated LUIS JSON to stdout	|
|-a, --gen_qna_only										| Write generated QnA JSON to stdout 	|
|-s, --luis_schema_version \<luis_schema_version\>  	| LUIS Schema version |
|-v, --luis_versionId \<luis_versionId\>	          	| LUIS app version ID |
|-n, --luis_name \<luis_Name\>                     		| LUIS app name |
|-d, --luis_desc \<luis_desc\>                    		| LUIS app description |
|-c, --luis_culture \<luis_culture\>                  	| LUIS app culture |
|-t, --write_luis_batch_tests							| Writes out a separate LUIS batch test file |
|-i, --lOutFile \<luisJSONFileName\>					| LUIS JSON output file name	|
|-m, --qna_name \<qna_Name\>                          	| QnA KB name |
|-l, --qOutFile \<qnaMakerJSONFileName\>				| QnA Maker JSON output file name	|
|-e, --qTSVFile \<qnaMakerTSVFileName\>					| QnA Maker TSV ouput file name 	|
|-V, --Version											| Current tool version information  |

## Output
LUDown tool will output:
- LUIS json file if any LUIS concept definitions are found in the .lu file(s)
- QnA json file if any QnAMaker.ai concept definitions are found in the .lu file(s)
- QnA TSV file if any QnAMaker.ai concept definitions are found in the .lu file(s)
- Optionally generates a LUIS batch testing file 

## Consuming output of LUDown tool
Once you have run LUDown, you can use the resulting JSON files in several ways: 
- Using command line tools like luis.exe, qna.exe
- Using the LUIS and QnA maker portals

### Creating a new LUIS app
#### using command line 
```bash
luis import application --in _LUISApp.json --authoringKey ""
```
Note: You can install LUIS CLI from [here](https://github.com/Microsoft/botbuilder-tools/tree/master/LUIS)

#### using [LUIS](http://luis.ai) portal
- Navigate to [LUIS](http://luis.ai)
- Sign in
- Click on My apps
- "Import new App"
- Choose file -> select the _LUISApp.json generated by LUDown tool

#### Creating and adding batch tests to [LUIS](http://luis.ai) app
You can create the input JSON for [batch testing](https://docs.microsoft.com/en-us/azure/cognitive-services/luis/luis-concept-batch-test) in LUIS using:

```bash
ludown --write_luis_batch_tests <.lufile>
```
This command will write out a _LUISBatchTest.json file

You can then import this to batch testing by following these steps
- Navigate to [LUIS](http://luis.ai)
- Sign in
- Click on My apps
- Open the LUIS app you wish to add this as batch test input
- Click on Test (top right corner)
- Click on 'Batch testing panel'
- Click on 'Import dataset'
- Click on 'Choose File' and provide the _LUISBatchTest.json file that was generated by ludown tool
- Give a name for the dataset
- Click Done

### Creating a new QnAMaker KB
#### using command line
```bash
qnamaker create --in _qnaKB.json
```
#### using [QnAMaker.ai](http://qnamaker.ai) portal
- Naviagate to [QnAMaker](http://qnamaker.ai)
- Sign in
- Create a new service with just the name and no other attributes
- Once the service is created, click on 'Replace Knowledge Base'
- Select _qnaTSV.tsv that was generated by LUDown

## .lu File Format
.lu files contain markdown-like, simple text based definitions for [LUIS](http://luis.ai) or [QnAmaker.ai](http://qnamaker.ai) concepts. 

### Intent
An intent represents actions the user wants to perform. The intent is a purpose or goal expressed in a user's input, such as booking a flight, paying a bill, or finding a news article. You define and name intents that correspond to these actions. A travel app may define an intent named "BookFlight."

Here's a simple .lu file that captures a simple 'Greeting' intent with a list of example utterances that capture ways users can express this intent. You can use - or + or * to denote lists. Numbered lists are not supported.

```markdown
# Greeting
- Hi
- Hello
- Good morning
- Good evening
```

'#\<intent-name\>' describes a new intent definition section. Each line after the intent definition are example utterances that describe that intent.

You can stitch together multiple intent definitions in a single file like this:

```markdown
# Greeting
- Hi
- Hello
- Good morning
- Good evening

# Help
- help
- I need help
- please help
```
Each section is idenfied by #\<intent name\> notation. Blank lines are skipped when parsing the file.

### Entity
An entity represents detailed information that is relevant in the utterance. For example, in the utterance "Book a ticket to Paris", "Paris" is a location. 

|Sample user utterance|entity|
|--------------------------|----------|
|"Book a flight to **Seattle**?"|Seattle|
|"When does your store **open**?"|open|
|"Schedule a meeting at **1pm** with **Bob** in Distribution"|1pm, Bob|

Entity in .lu file is denoted using {\<entityName\>=\<labelled value\>} notation. Here's an example: 

```markdown
# CreateAlarm
- book a flight to {toCity=seattle}
- book a flight from {fromCity=new york} to {toCity=seattle}
```

LUDown tool supports the following [LUIS entity types](https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/luis-concept-entity-types)
- Prebuilt ("datetimeV2", "age", "dimension", "email", "money", "number", "ordinal", "percentage", "phoneNumber","temperature", "url")
- List
- Simple

LUDown tool <b>*does not*</b> support the following LUIS entity types:
- Regular expression
- Hierarchical
- Composite

You can define an entity type by using the $\<entityName\>:\<entityType\> notation. Note that the parser defaults to simple entity type.
Here's an example: 

```markdown
# CreateAlarm
- create an alarm for {alarmTime=7AM}
- set an alarm for {alarmTime=7AM}

$alarmTime:Simple
```
Pre-built entities only need to be defined once and are applicable to your entire application. Here's an example: 
```markdown 
# Add
- 1 + 1

// 1's in the "1 + 1" utterance will automatically be picked up as numbers by LUIS
$PREBUILT:number 

# BookTable
- book a table for tomorrow
- book a table for 3pm
- book a table for next thursday 4pm

// all date or time or date and time in utterances will automatically be picked by LUIS as datetime values
$PREBUILT:datetimeV2
```

You can describe list entites using the following notation:
$listEntity:\<normalized-value\>=
    - \<synonym1\>
    - \<synonym2\>

Here's an example definition of a list entity: 

```markdown
$commPreference:call=
	- phone call
	- give me a ring
	- ring
	- call
	- cell phone
	- phone
$commPreference:text=
	- message
	- text
	- sms
	- text message
```

You can also enhance LUIS understanding of your model using [PhraseLists](https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/luis-tutorial-interchangeable-phrase-list)

Here's an example of a phrase list definition:

```markdown
$ChocolateType:phraseList
    - m&m,mars,mints,spearmings,payday

> You can also break up the phrase list values into an actual list
$ChocolateType:phraseList
    - jelly
	- kit kat
	- kitkat
	- twix
```

### Patterns
Patterns are a new feature in LUIS that allows you to define a set of rules that augment the machine learned model. You can define patterns in the .lu file simply by defining an entity in an utterance without a labelled value. 

As an example, this would be treated as a pattern with alarmTime set as a Pattern.Any entity type
```markdown
# DeleteAlarm
- delete the {alarmTime} alarm
``` 
This example would be treated as an utterance since it has a labelled value with 7AM being the labelled value for entity alarmTime
```markdown
# DeleteAlarm
- delete the {alarmTime=7AM} alarm
```

Note: By default any entity that is left undescribed in a pattern will be mapped to Pattern.Any entity type.

### Question and Answer pairs
.lu file (and the parser) supports question and answer definitions as well. You can this notation to describe them
\# ?\<question\>
\[list of question variations]
\```
	\<answer\>
\```

Here's an example of question and answer definitions. The LUDown tool will automatically separate question and answers into a qnamaker JSON file that you can then use to create your new [QnaMaker.ai](http://qnamaker.ai) knowledge base article.

```markdown
> # QnA Definitions
> This is a QnA definition. Follows # ? Question: \<list of questions\> \```markdown \<Answer> ``` format

### ? who is the ceo?
	\```markdown
	You can change the default message if you use the QnAMakerDialog. 
	See [this link](https://docs.botframework.com/en-us/azure-bot-service/templates/qnamaker/#navtitle) for details. 
	\```

### ? How do I programmatically update my KB?
	\```markdown
	You can use our REST apis to manage your KB. 
	\#1. See here for details: https://westus.dev.cognitive.microsoft.com/docs/services/58994a073d9e04097c7ba6fe/operations/58994a073d9e041ad42d9baa
	\```
```

You can add multiple questions to the same answer by simply additing variations to questions. Here's an example

```
### ? Who is your ceo?
- get me your ceo info
	\```markdown
	Vishwac
	\```
```

### External references
Two different references are supported in the .lu file. These follow Markdown link syntax.
- Reference to another .lu file via \[link name](\<.lu file name\>). Ref can be an absolute path or <b>relative path from the containing .lu file</b>
- Reference to URL for QnAMaker to ingest during KB creation via \[link name](\<URL\>)

Here's an example of those references: 

```markdown
[QnaURL](https://docs.microsoft.com/en-in/azure/cognitive-services/qnamaker/faqs)

[none intent definition](./none.lu)
```

### Adding comments
You can add comments to your .lu document by prefixing the comment with >. Here's an example: 

```markdown
> This is a comment and will be ignored

# Greeting
- hi
- hello
```

Checkout the [examples](https://github.com/Microsoft/botbuilder-tools/tree/master/ludown/Examples) folder for additional example .lu files.